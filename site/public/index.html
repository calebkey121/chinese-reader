<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Chinese Reader</title>
    <link rel="stylesheet" href="./styles.css" />
    <script>
      // Apply saved theme early to avoid flash
      (function () {
        const saved = localStorage.getItem("theme"); // "dark" | "light" | null
        if (saved === "dark" || saved === "light") {
          document.documentElement.dataset.theme = saved;
        }
      })();
    </script>
  </head>
  <body>
    <div id="app">
      <div class="topbar primary">
        <div class="nav">
          <button id="navStories" class="nav-btn is-active" type="button">Stories</button>
          <button id="navVocab" class="nav-btn" type="button">Vocab</button>
        </div>
  
        <button id="themeToggle" type="button" title="Toggle dark mode">Dark</button>
      </div>
      <div id="storiesControls" class="topbar secondary stories-controls">
        <select id="bookSelect"></select>
        <select id="chapterSelect"></select>
        <button id="playAllBtn" type="button">Play</button>

        <label class="speed">
          Speed
          <input id="ttsRate" type="range" min="0.01" max="1" step="0.05" value="1" />
          <span id="ttsRateLabel">1.00×</span>
        </label>
      </div>

      <div id="storiesView" class="view">
        <div class="reader">
          <h2 id="title" class="chapter-title"></h2>
          <div id="reader"></div>
        </div>
      </div>

      <div id="vocabView" class="view hidden">
        <div class="vocab">
          <div id="vocabSummaryPanel">
            <div class="vocab-header-row">
              <h2 class="vocab-title">HSK Progress</h2>

              <div class="segmented" role="group" aria-label="HSK version">
                <button id="schema30" type="button" class="seg-btn is-active">HSK 3.0</button>
                <button id="schema20" type="button" class="seg-btn">HSK 2.0</button>
              </div>
            </div>

            <div id="hskCards" class="hsk-cards"></div>
            <div id="vocabNote" class="vocab-note">Click an HSK card to view the full list.</div>
          </div>

          <div id="vocabLevelPanel" class="hidden">
            <div class="vocab-level-header">
              <button id="vocabBackBtn" type="button" class="btn-secondary">Back</button>
              <div>
                <div id="vocabLevelTitle" class="vocab-level-title">HSK</div>
                <div id="vocabLevelMeta" class="vocab-level-meta"></div>
              </div>
            </div>

            <div class="vocab-controls">
              <div class="segmented" role="group" aria-label="Filter">
                <button id="filterAll" type="button" class="seg-btn is-active">All</button>
                <button id="filterLearned" type="button" class="seg-btn">Learned</button>
                <button id="filterNotLearned" type="button" class="seg-btn">Not learned</button>
              </div>

              <input
                id="vocabSearch"
                class="vocab-search"
                type="search"
                placeholder="Search… (Chinese / pinyin / English)"
                autocomplete="off"
              />
            </div>

            <div id="vocabList" class="vocab-list"></div>
          </div>
        </div>
      </div>

      <div id="popup" class="popup hidden">
        <div class="popup-head">
          <div id="popupWord" class="popup-word"></div>
        </div>
        <div id="popupPinyin" class="popup-line"></div>
        <div id="popupDefs" class="popup-line"></div>
        <div id="popupDebug" class="popup-debug"></div>
      </div>
    </div>

    <script src="./app.js"></script>
  </body>
</html>